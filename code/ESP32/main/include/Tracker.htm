#pragma once

const char onload_script[] PROGMEM = R"rawliteral(
  loadSettings();
  const form = document.getElementById('settingsForm');
  if (form) {
    form.addEventListener('submit', saveSettings);
  }
)rawliteral";

const char app_script[] PROGMEM = R"rawliteral(
<script>
  async function loadSettings() {
    const status = document.getElementById('status');
    try {
      const res = await fetch('/appsettings', { method: 'GET' });
      if (!res.ok) throw new Error('Failed to load');
      const cfg = await res.json();
      setFormValues(cfg);
    } catch (e) {
      status.innerHTML = '<span class="err">Load failed.</span>';
    }
  }

  function setFormValues(cfg) {
    const form = document.getElementById('settingsForm');
    for (const [k, v] of Object.entries(cfg)) {
      const el = form.elements.namedItem(k);
      if (!el) continue;
      if (el.type === 'checkbox') el.checked = !!v;
      else el.value = v;
    }
  }

  function getFormValues() {
    const form = document.getElementById('settingsForm');
    const data = {};
    for (const el of form.elements) {
      if (!el.name) continue;
      if (el.type === 'checkbox') data[el.name] = el.checked;
      else if (el.type === 'number') data[el.name] = el.value === '' ? null : Number(el.value);
      else data[el.name] = el.value;
    }
    return data;
  }

  function validateElevationBounds(data) {
    const minEl = data._minimumElevation;
    const maxEl = data._maximumElevation;
    if (minEl != null && maxEl != null && minEl > maxEl) {
      throw new Error('Minimum elevation must be â‰¤ maximum elevation.');
    }
  }

  async function saveSettings(evt) {
    evt.preventDefault();
    const status = document.getElementById('status');
    status.textContent = '';

    try {
      const data = getFormValues();
      validateElevationBounds(data);

      const res = await fetch('/settings', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      console.log("saveSettings:", JSON.stringify(data));
      if (!res.ok) throw new Error('Save failed');
      status.innerHTML = '<span class="ok">Settings saved.</span>';
    } catch (e) {
      status.innerHTML = '<span class="err">' + e.message + '</span>';
    }
  }

    function sendCommand(cmd) {
      console.log("Command:", cmd);
      // Example: send to device via HTTP
      fetch('/control', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ command: cmd })
      })
      .then(res => res.text())
      .then(txt => console.log("Response:", txt))
      .catch(err => console.error("Error:", err));
    }
    
</script>

)rawliteral";

const char home_html[] PROGMEM = R"rawliteral(
<!DOCTYPE html>
<html lang=\"en\">

<head>
  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, user-scalable=no\" />
  <title>{n}</title>

  <script>

  </script>
  {style}
</head>

<body>
  <div id="home">
    <div id="hdr">
      <h2>{n}</h2>
      <div style='font-size: .6em;'>Firmware config version '{v}'</div>
      <hr>
      <div class="controller">
        <button class="up"    onclick="sendCommand('up')">Up</button>
        <button class="left"  onclick="sendCommand('left')">Left</button>
        <button class="stop"  onclick="sendCommand('stop')">Stop</button>
        <button class="right" onclick="sendCommand('right')">Right</button>
        <button class="down"  onclick="sendCommand('down')">Down</button>
      </div>

      <div class="link-row">
        <p><a href='settings'>Settings</a></p>
        <p><a href='/log' target='_blank'>Web Log</a></p>
      </div>
    </div>
  </div>
</body>

</html>
)rawliteral";

const char app_config[] PROGMEM = R"rawliteral(
<div>
  <div class="grid">
    <!-- Booleans -->
    <div class="field">
      <label for="_dualAxis">Dual axis</label>
      <div class="check">
        <input type="checkbox" id="_dualAxis" name="_dualAxis" />
        <span class="muted">Dual-axis Tracker</span>
      </div>
    </div>
    <div class="field">
      <label for="_hasAnemometer">Anemometer present</label>
      <div class="check">
        <input type="checkbox" id="_hasAnemometer" name="_hasAnemometer" />
        <span class="muted">Has Anemometer</span>
      </div>
    </div>

    <!-- Geolocation -->
    <div class="field">
      <label for="_latitude">Latitude (degrees, -90&deg; to 90&deg;)</label>
      <input type="number" id="_latitude" name="_latitude" min="-90" max="90" step="any"/>
    </div>
    <div class="field">
      <label for="_longitude">Longitude (degrees, -180&deg; to 180&deg;)</label>
      <input type="number" id="_longitude" name="_longitude" min="-180" max="180" step="any"/>
    </div>

    <!-- Azimuths -->
    <div class="field">
      <label for="_eastAzimuth">East azimuth (0-360&deg;)</label>
      <input type="number" id="_eastAzimuth" name="_eastAzimuth" step="1" min="0" max="360" inputmode="numeric" />
    </div>
    <div class="field">
      <label for="_westAzimuth">West azimuth (0-360&deg;)</label>
      <input type="number" id="_westAzimuth" name="_westAzimuth" step="1" min="0" max="360" inputmode="numeric" />
    </div>

    <!-- Elevation limits -->
    <div class="field">
      <label for="_minimumElevation">Minimum elevation (degrees, 0-90&deg;)</label>
      <input type="number" id="_minimumElevation" name="_minimumElevation" step="1" min="0" max="90" inputmode="numeric" />
    </div>
    <div class="field">
      <label for="_maximumElevation">Maximum elevation (degrees, 0-90&deg;)</label>
      <input type="number" id="_maximumElevation" name="_maximumElevation" step="1" min="0" max="90" inputmode="numeric" />
    </div>

    <!-- Travel lengths -->
    <div class="field">
      <label for="_horizontalLength">Horizontal travel length (inches)</label>
      <input type="number" id="_horizontalLength" name="_horizontalLength" step="1" min="0" inputmode="numeric"/>
    </div>
    <div class="field">
      <label for="_verticalLength">Vertical travel length (inches)</label>
      <input type="number" id="_verticalLength" name="_verticalLength" step="1" min="0" inputmode="numeric" />
    </div>

    <!-- Speeds -->
    <div class="field">
      <label for="_horizontalSpeed">Horizontal speed (inches/s)</label>
      <input type="number" id="_horizontalSpeed" name="_horizontalSpeed" step="1" min="0" inputmode="numeric" />
    </div>
    <div class="field">
      <label for="_verticalSpeed">Vertical speed (inches/s)</label>
      <input type="number" id="_verticalSpeed" name="_verticalSpeed" step="1" min="0" inputmode="numeric" />
    </div>
  </div>
  <div id="status" class="status"></div>
</div>
)rawliteral";