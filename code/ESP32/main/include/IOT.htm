const char *redirect_html PROGMEM = R"rawliteral(
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{n}</title>
        <script>
            window.onload = function() {
                window.location.href = "http://{ip}";
            };
        </script>
    </head>
    <body>
        <h1>Redirecting to Home Page...</h1>
    </body>
    </html>
)rawliteral";

const char update_html[] PROGMEM = R"rawliteral(
    <!DOCTYPE html><html lang=\"en\"><head><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, charset=utf-8">
    <title>Firmware Update</title>
    </head><body>
    <h1>Firmware Update</h1>
    <h1>ESP32 OTA Update</h1>
    <form method='POST' action='/doupdate' enctype='multipart/form-data'>
    <input type='file' name='firmware'>
    </form>
    <div>
        Copyright (c) 2025. ClassicDIY</br>
        The source code is hosted and available on Github at <a href="https://github.com/classicdiy/ESP_PLC" target="_blank">https://github.com/classicdiy/ESP_PLC</a>.</br>
        The software is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</br>
    </div>
    </body></html>
)rawliteral";

const char network_config_top[] PROGMEM = R"rawliteral(
    <!DOCTYPE html><html lang=\"en\"><head><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>{n}</title>
    <script>
      const NetworkSelection = ["NotConnected", "APMode", "WiFiMode", "EthernetMode", "ModemMode"];
      const NetworkSelectionEnum = {
        NotConnected: 0,
        APMode: 1,
        WiFiMode: 2,
        EthernetMode: 3,
        ModemMode: 4
      };
      const ModbusMode = ["tcp", "rtu"];
      const ModbusModeEnum = {
        tcp: 0,
        rtu: 1
      };
      const UART_Parity = ["none", "", "even", "odd"];
      const UART_ParityEnum = {
        none: 0,
        even: 2,
        odd: 3
      };
      const UART_StopBits = ["1", "1.5", "2", "max"];
      const UART_StopBitsEnum  = {
        1: 0,
        2: 2,
      };

      function dhcpCheck(checkbox) {
          const fieldset = document.getElementById("dhcp");
          fieldset.disabled = checkbox.checked;
      }
      function mqttFieldset(checkbox) {
          const fieldset = document.getElementById("mqtt");
          fieldset.disabled = !checkbox.checked;
      }
      function modbusFieldset(checkbox) {
          const fieldset = document.getElementById("modbus");
          fieldset.disabled = !checkbox.checked;
      }
      function modbusBridgeFieldset(checkbox) {
          const fieldset = document.getElementById("modbusBridge");
          fieldset.disabled = !checkbox.checked;
      }
      function showMBFields() {
          document.querySelectorAll('#modbusSelector-container > div').forEach(div => div.classList.add('hidden'));
          var selectedFld = document.getElementById('modbusModeSelector');
          if (selectedFld) {
              document.getElementById(selectedFld.value + '-fields').classList.remove('hidden');
          }
          toggleMDBridgeFieldset();
      }
      function showFields() {
          // Hide all fields
          document.querySelectorAll('#networkSelector-container > div').forEach(div => div.classList.add('hidden'));
          // Get selected value
          var selectedValue = document.getElementById('networkSelector').value.trim();
          if (selectedValue === "APMode") {
            var modbusEl = document.getElementById('modbus');
            if (modbusEl) {
              modbusEl.classList.add('hidden');
            }
            var mqttEl = document.getElementById('mqtt');
            if (mqttEl) {
              mqttEl.classList.add('hidden');
            }
          }
          else {
              document.getElementById(selectedValue + '-fields').classList.remove('hidden');
              var mqttEl = document.getElementById('mqtt');
              if (mqttEl) {
                mqttEl.classList.remove('hidden');
              }
              var modbusEl = document.getElementById('modbus');
              if (modbusEl) {
                modbusEl.classList.remove('hidden');
              }
              showMBFields();
          }
      }

      function toggleMDBridgeFieldset() {
        const selector = document.getElementById("modbusModeSelector");
        const fieldset = document.getElementById("modbusBridge");
        if (fieldset) {
          fieldset.classList.toggle("hidden", selector.value === "rtu");
        }
      }

      window.onload = function() {
        loadSettings();
        {onload}
        const form = document.getElementById('settingsForm');
        if (form) {
          form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const status = document.getElementById('status');
            status.textContent = '';
            try {
              const data = getFormValues();
              const res = await fetch('/settings', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
              });
              console.log(await res.text());
              if (!res.ok) throw new Error('Save failed');
              status.innerHTML = '<span class="ok">Settings saved.</span>';
            } catch (e) {
              status.innerHTML = '<span class="err">' + e.message + '</span>';
            }
          });

        }
      }
      function validateInputs() {
          {validateInputs}
          return true;
      }

      async function loadSettings() {
      const status = document.getElementById('status');
        try {
          const res = await fetch('/appsettings', { method: 'GET' });
          if (!res.ok) throw new Error('Failed to load');
          const cfg = await res.json();
          setAppValues(cfg);
        } catch (e) {
          status.innerHTML = '<span class="err">Load failed.</span>';
        }
        try {
          const res = await fetch('/iotsettings', { method: 'GET' });
          if (!res.ok) throw new Error('Failed to load');
          const cfg = await res.json();
          setIotValues(cfg);
          showFields();
          var mqttEl = document.getElementById('mqttCheckbox');
          if (mqttEl) {
            mqttFieldset(mqttEl);
          }
          var modbusEl = document.getElementById('modbusCheckbox');
          if (modbusEl) {
            modbusFieldset(modbusEl);
            modbusBridgeFieldset(document.getElementById("modbusBridgeCheckbox"));
            toggleMDBridgeFieldset();
          }
          var dhcpEl = document.getElementById('useDHCP');
          if (dhcpEl) {
            dhcpCheck(dhcpEl);
          }
        } catch (e) {
          status.innerHTML = '<span class="err">Load failed.</span>';
        }
      }

      function setIotValues(cfg) {
        const form = document.getElementById('settingsForm');
        for (const [k, v] of Object.entries(cfg)) {
          const el = form.elements.namedItem(k);
          if (!el) continue;
          if (el.type === 'checkbox') {
            el.checked = !!v;
          } else if (el.tagName === 'SELECT') {
            // Special handling for select elements with enum values
            if (k === "Network") {
              el.value = NetworkSelection[v];
            } else if (k === "modbusMode") {
              el.value = ModbusMode[v];
            } else if (k === "svrRTUParity") {
              el.value = UART_Parity[v];
            } else if (k === "svrRTUStopBits") {
              el.value = UART_StopBits[v];
             } else if (k === "modbusClientParity") {
              el.value = UART_Parity[v];
            } else if (k === "modbusClientStopBits") {
              el.value = UART_StopBits[v];
            }
          } else {
             el.value = v;
          }
        }
      }

      function setAppValues(cfg) {
        const form = document.getElementById('settingsForm');
        for (const [k, v] of Object.entries(cfg)) {
          const el = form.elements.namedItem(k);
          if (!el) continue;
          if (el.type === 'checkbox') {
            el.checked = !!v;
          } else {
             el.value = v;
          }
        }
      }

      function getFormValues() {
        const form = document.getElementById('settingsForm');
        const data = {};
        for (const el of form.elements) {
          if (!el.name) continue;
          if (el.type === 'checkbox') {
            data[el.name] = el.checked;
          } else if (el.type === 'number') {
            data[el.name] = el.value === '' ? null : Number(el.value);
          } else if (el.tagName === 'SELECT') {
            // Special handling for select elements with enum values
            if (el.name === "Network") {
              data[el.name] = NetworkSelectionEnum[el.value];
            } else if (el.name === "modbusMode") {
              data[el.name] = ModbusModeEnum[el.value];
            } else if (el.name === "svrRTUParity") {
              el.value = UART_ParityEnum[el.value];
            } else if (el.name === "svrRTUStopBits") {
              el.value = UART_StopBitsEnum[el.value];
             } else if (el.name === "modbusClientParity") {
              el.value = UART_ParityEnum[el.value];
            } else if (el.name === "modbusClientStopBits") {
              el.value = UART_StopBitsEnum[el.value];
            }
          } else {
            data[el.name] = el.value;
          }
        }
        return data;
      }
      async function saveSettings(evt) {
        evt.preventDefault();
        const status = document.getElementById('status');
        status.textContent = '';

        try {
          const data = getFormValues();
          {validate}

          const res = await fetch('/settings', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
          console.log("saveSettings:", JSON.stringify(data));
          if (!res.ok) throw new Error('Save failed');
          status.innerHTML = '<span class="ok">Settings saved.</span>';
        } catch (e) {
          status.innerHTML = '<span class="err">' + e.message + '</span>';
        }
      }
    {script}
    </script>
    {style}
    </head>
    <body>
      <div id="config">
      <div id="hdr">
          <h2>{n}</h2>
          <div class="ver">Firmware version '{v}'</div>
          <hr>
      </div>

)rawliteral";

const char network_config[] PROGMEM = R"rawliteral(
<form id="settingsForm" method='post'>
<fieldset id="network" class="fs">
  <legend>Network</legend>

  <div class="form-grid">
    <label for="AP_SSID">AP SSID/Device Name</label>
    <input type="text" id="AP_SSID" name="AP_SSID" required maxlength="32">
  </div>

  <div class="form-grid">
    <label for="AP_Pw">AP/admin Password</label>
    <input type="text" id="AP_Pw" name="AP_Pw" minlength="8" required maxlength="32">
  </div>

  <div class="form-grid">
    <label for="networkSelector">Network Mode</label>
    <select id="networkSelector" name="Network" onchange="showFields()">
      <option value="APMode" >AP Mode</option>
      <option value="WiFiMode">WiFi</option>
      <option value="EthernetMode" {ETH}>Ethernet</option>
      <option value="ModemMode" {4G}>4G Modem</option>
    </select>
  </div>

  <div id="networkSelector-container">
    <div id="WiFiMode-fields" class="hidden">
      <div class="form-grid">
        <label for="SSID">WiFi SSID</label>
        <input type="text" id="SSID" name="SSID" maxlength="32">
      </div>
      <div class="form-grid">
        <label for="WiFi_Pw">WiFi Password</label>
        <input type="text" id="WiFi_Pw" name="WiFi_Pw"maxlength="32">
      </div>
    </div>

    <div id="EthernetMode-fields" class="hidden">
      <fieldset id="dhcp" class="fs">
        <legend>
          <label><input type="checkbox" id="useDHCP" name="useDHCP" onclick="dhcpCheck(this)" > Use DHCP</label>
        </legend>
        <div class="form-grid">
          <label for="ETH_SIP">Static IP</label>
          <input type="text" id="ETH_SIP" name="ETH_SIP" maxlength="32">
        </div>
        <div class="form-grid">
          <label for="ETH_SM">Subnet Mask</label>
          <input type="text" id="ETH_SM" name="ETH_SM" maxlength="32">
        </div>
        <div class="form-grid">
          <label for="ETH_GW">Gateway</label>
          <input type="text" id="ETH_GW" name="ETH_GW" maxlength="32">
        </div>
      </fieldset>
    </div>

    <div id="ModemMode-fields" class="hidden">
      <div class="form-grid">
        <label for="APN">APN</label>
        <input type="text" id="APN" name="APN" maxlength="32">
      </div>
      <div class="form-grid">
        <label for="SIM_USERNAME">Username</label>
        <input type="text" id="SIM_USERNAME" name="SIM_USERNAME" maxlength="32">
      </div>
      <div class="form-grid">
        <label for="SIM_PASSWORD">Password</label>
        <input type="text" id="SIM_PASSWORD" name="SIM_PASSWORD" maxlength="32">
      </div>
      <div class="form-grid">
        <label for="SIM_PIN">PIN</label>
        <input type="text" id="SIM_PIN" name="SIM_PIN" maxlength="32">
      </div>
    </div>
  </div>
</fieldset>
)rawliteral";

const char config_mqtt[] PROGMEM = R"rawliteral(
  <fieldset id="mqtt" class="fs">
    <legend>
      <label><input type="checkbox" id="mqttCheckbox" name="useMQTT" onclick="mqttFieldset(this)" > MQTT</label>
    </legend>

    <div class="form-grid">
      <label for="mqttServer">MQTT Server</label>
      <input type="text" id="mqttServer" name="mqttServer" maxlength="64">
    </div>

    <div class="form-grid">
      <label for="mqttPort">MQTT Port</label>
      <input type="number" id="mqttPort" name="mqttPort"  step="1">
    </div>

    <div class="form-grid">
      <label for="mqttUser">MQTT User</label>
      <input type="text" id="mqttUser" name="mqttUser" maxlength="32">
    </div>

    <div class="form-grid">
      <label for="mqttPw">MQTT Password</label>
      <input type="text" id="mqttPw" name="mqttPw" maxlength="32">
    </div>
  </fieldset>
)rawliteral";

const char config_modbus[] PROGMEM = R"rawliteral(
  <fieldset  id="modbus" class="fs">
    <legend><label><input type="checkbox" id="modbusCheckbox" name="useModbus" onclick="modbusFieldset(this)" {modbuschecked}> Modbus</label></legend>

    <div class="form-grid">
      <label for="modbusModeSelector">Modbus Mode</label>
      <select id="modbusModeSelector" name="modbusMode" onchange="showMBFields()">
        <option value="tcp" {TCP}>TCP</option>
        <option value="rtu" {RTU}>RTU</option>
      </select>
    </div>
    <div id="modbusSelector-container">
      <div id="tcp-fields" class="form-grid hidden">
        <label for="modbusPort">Modbus Port</label>
        <input type="number" id="modbusPort" name="modbusPort" step="1">
      </div>

      <div id="rtu-fields" class="hidden">
        <div class="form-grid">
          <label for="svrRTUBaud">RTU Baud Rate</label>
          <select id="svrRTUBaud" name="svrRTUBaud">
            <option value="9600" {RTU_SVR_9600} >9600</option>
            <option value="19200" {RTU_SVR_19200} >19200</option>
            <option value="38400" {RTU_SVR_38400} >38400</option>
            <option value="115200" {RTU_SVR_115200} >115200</option>
          </select>
        </div>
        <div class="form-grid">
          <label for="svrRTUParity">RTU Parity</label>
          <select id="svrRTUParity" name="svrRTUParity">
            <option value="none" {RTU_SVR_Parity_None}>None</option>
            <option value="even" {RTU_SVR_Parity_Even}>Even</option>
            <option value="odd" {RTU_SVR_Parity_Odd}>Odd</option>
          </select>
        </div>
        <div class="form-grid">
          <label for="svrRTUStopBits">RTU Stop Bits</label>
          <select id="svrRTUStopBits" name="svrRTUStopBits">
            <option value="1" {RTU_SVR_1Stop}>1</option>
            <option value="2" {RTU_SVR_2Stop}>2</option>
          </select>
        </div>
      </div>
    </div>
    <div class="form-grid"><label for="modbusID">Modbus ID</label><input type="number" id="modbusID" name="modbusID" step="1"></div>
    <div {inputRegDivClass}>
      <div class="form-grid"><label for="inputRegBase">Input Register Address</label><input type="number" id="inputRegBase" name="inputRegBase" step="1" min="0" max="65531"></div>
    </div>
    <div {coilDivClass}>
      <div class="form-grid"><label for="coilBase">Coil Address</label><input type="number" id="coilBase" name="coilBase" step="1" min="0" max="65529"></div>
    </div>
    <div {discreteDivClass}>
        <div class="form-grid"><label for="discreteBase">Discrete Address</label><input type="number" id="discreteBase" name="discreteBase"  step="1" min="0" max="65531"></div>
    </div>
    <div {holdingRegDivClass}>
        <div class="form-grid"><label for="holdingRegBase">Holding Register Address</label><input type="number" id="holdingRegBase" name="holdingRegBase" step="1" min="0" max="65531"></div>
    </div>
    </fieldset>  
)rawliteral";

const char config_modbusBridge[] PROGMEM = R"rawliteral(
  <fieldset id="modbusBridge" class="fs">
    <legend><label><input type="checkbox" id="modbusBridgeCheckbox" name="useModbusBridge" onclick="modbusBridgeFieldset(this)" {modbusBridgechecked}> Modbus Bridge</label></legend>
    <div class="form-grid">
      <label for="clientRTUBaud">RTU Baud Rate</label>
      <select id="clientRTUBaud" name="clientRTUBaud">
        <option value="9600" {RTU_CLIENT_9600} >9600</option>
        <option value="19200" {RTU_CLIENT_19200} >19200</option>
        <option value="38400" {RTU_CLIENT_38400} >38400</option>
        <option value="115200" {RTU_CLIENT_115200} >115200</option>
      </select>
    </div>
    <div class="form-grid">
      <label for="clientRTUParity">RTU Parity</label>
      <select id="clientRTUParity" name="modbusClientParity">
        <option value="none" {RTU_CLIENT_Parity_None}>None</option>
        <option value="even" {RTU_CLIENT_Parity_Even}>Even</option>
        <option value="odd" {RTU_CLIENT_Parity_Odd}>Odd</option>
      </select>
    </div>
    <div class="form-grid">
      <label for="clientRTUStopBits">RTU Stop Bits</label>
      <select id="clientRTUStopBits" name="modbusClientStopBits">
        <option value="1" {RTU_CLIENT_1Stop}>1</option>
        <option value="2" {RTU_CLIENT_2Stop}>2</option>
      </select>
    </div>
    {modbusBridgeAppSettings}
  </fieldset>
)rawliteral";

const char config_apply_button[] PROGMEM = R"rawliteral(
  <div id="status" class="status"></div>
  <div class="actions">
    <button type="submit" >Apply</button>
  </div>
  </form>
)rawliteral";

const char config_links[] PROGMEM = R"rawliteral(
  <div class="link-row">
    <a href='/'>Home page</a>
    <a href='/update'>Firmware update</a>
    <a href='/reboot'>Reboot</a>
  </div>
  </body></html>
)rawliteral";

const char config_links_no_ota[] PROGMEM = R"rawliteral(
  <div class="link-row">
    <a href='/'>Home page</a> 
    <a href='/reboot'>Reboot</a> 
  </div>
  </body></html>
)rawliteral";
